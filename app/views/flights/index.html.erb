<div class="container">
  <div class="banner_destination_picture">
   <img src="" alt="">
  </div>

  <div class="inline_search_bar">
    <div class="inline_search_form">
      <div class="card-panel blue-text text-darken-2 search_card">
        <!-- définir la route exact et le type de méthode get/post -->
        <%= form_tag(flights_path, method: :get) do %>
        <div class="row">
        <div class="line1 col s12 "></div>
          <div class="input-field col m3 s6">
            <%= number_field(:duration, nil, in: 1..30, step: 1, placeholder: "Durée du séjour en jours", class: "validate") %>
          </div>
          <div class="input-field col m3 s6">
            <%= select_tag(:periode, options_for_select(@periode), multiple: false) %>
          </div>
          <div class="input-field col m3 s6">
            <%= text_field_tag(:departure, nil, placeholder:"Départ", class: "validate") %>
          </div>
          <div class="input-field col m3 s6">
            <%= text_field_tag(:destination, nil, placeholder:"Destination", class: "validate") %>
          </div>
        </div>
        <div class="row">
          <div class="line2 col s12">
            <div class="passagers_selection col s6">
              <div class="input-field passagers_child col s2">
                <p>Enfant(s)</p>
                <%= select_tag(:passagers_child, options_for_select(@passagers_number), class: "browser-default") %>
              </div>
              <div class="input-field passagers_young col s2">
                <p>Jeune(s)</p>
                <%= select_tag(:passagers_young, options_for_select(@passagers_number), class: "browser-default") %>
              </div>
              <div class="input-field passagers_adult col s2">
                <p>Adulte(s)</p>
                <%= select_tag(:passagers_adult, options_for_select(@passagers_number), class: "browser-default") %>
              </div>
            </div>
            <div class="input-field col s4 offset-s1">
              <%= submit_tag("Rechercher", class: "search_button btn waves-effect waves-light") %>
            </div>
          </div>
           <div class="slider_price_duration">
            <form action="#">
              <p class="range-field">
                <input type="range" id="test5" min="0" max="100" />
              </p>
            </form>
           </div>
          </div>
        </div>
        <% end %>
      </div>
    </div>

  <div class="results_wrapper">
    <div class="results_lists">
      <% @trips_results.each_with_index do |trip, index|%>
        <div class="box_result">
          <div class="results_card_container">
            <div class="card_result" data-trip_index="<%= index %>">
              <div class="date_range_graph_field">
                <div class="date_range_graph">
                  <div class="date_representation_sliders" data-departure_date="<%= trip[:depart_flights][0].departure_datetime.to_date.strftime('%e').to_i %>" data-arrival_date="<%= trip[:return_flights][-1].arrival_datetime.to_date.strftime('%e').to_i %>"></div>
                  <p>Mars 2017</p>
                </div>
              </div>
              <div class="card_result_column2">
                <div class="flight_price">
                  <p><%= trip[:details][:price]%> <%= trip[:details][:currency]%></p>
                </div>
                <p>Temps de voyage</p>
                <div class="flights_durations_table">
                  <div class="start_flight_duration">
                    <p><i class="fa fa-plane" aria-hidden="true"></i>Aller</p>
                    <p><%= trip[:details][:start_trip_duration]%></p>
                  </div>
                  <div class="return_flight_duration">
                    <p><i class="fa fa-plane" aria-hidden="true"></i>Retour</p>
                    <p><%= trip[:details][:return_trip_duration]%></p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    <div id="results_details_container" class="results_details">
     <%= render 'result_details', result_details: @trips_results[0] %>
    </div>


  </div>
</div>
<% content_for(:after_js) do %>
  <script>
    $(document).ready(function(){
      // Slider initialization
      $('.date_representation_sliders').each(function(){
        var slider = noUiSlider.create(this, {
          start: [$(this).data('departure_date'), $(this).data('arrival_date')],
          connect: true,
          step: 1,
          range: {
            'min': 1,
            'max': 31,
          },
          disabled: true,
          format: wNumb({decimals: 0})
        });
        this.setAttribute('disabled', true);
      });

      // Flight results
      $('.flight_card').first().addClass('selected');
      var trips_results_details = [];
      <% @trips_results.each_with_index do |result_details, index| %>
        var result_details = "<%= j render 'result_details', result_details: result_details %>"
        trips_results_details[<%= index %>] = result_details
      <% end %>
      console.log(trips_results_details);
      // Register click on card result
      $('.card_result').click(function(){
        // Detect the index
        $('.card_result').removeClass('selected');
        $(this).toggleClass('selected');
        var index = $(this).data('trip_index');
        var result_details_div = trips_results_details[index];
        $('#results_details_container').html(result_details_div);
      })




    })
  </script>
<% end %>
