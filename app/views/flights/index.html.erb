<div class="container">
  <div class="go_home">
    <div class="logo_home">
      <i class="fa fa-home" aria-hidden="true"></i>
    </div>
  </div>


  <div class="row">
    <div class="results_wrapper col s12">
      <div class="results_lists col s6">
        <% @trips_results.each_with_index do |trip, index|%>
          <div class="box_result">
            <div class="results_card_container">
              <div class="card_result" data-trip_index="<%= index %>">
                <div class="date_range_graph_field">
                  <div class="date_range_graph">
                    <div class="date_representation_sliders" data-departure_date_day="<%= trip[:depart_flights][0].departure_datetime.to_date.strftime('%e').to_i %>" data-departure_date_month="<%= trip[:depart_flights][0].departure_datetime.to_date.strftime('%m') %>" data-arrival_date_day="<%= trip[:return_flights][-1].arrival_datetime.to_date.strftime('%e').to_i %>">
                    </div>
                    <p><%= @trip_periode%></p>
                  </div>
                </div>
                <div class="card_result_column2">
                  <div class="flight_price">
                    <p><%= trip[:details][:price]%> <%= trip[:details][:currency]%></p>
                  </div>
                  <p>Temps de voyage</p>
                  <div class="flights_durations_table">
                    <div class="start_flight_duration">
                      <p><i class="fa fa-plane" aria-hidden="true"></i>Aller</p>
                      <p><%= trip[:details][:start_trip_duration]%></p>
                    </div>
                    <div class="return_flight_duration">
                      <p><i class="fa fa-plane" aria-hidden="true"></i>Retour</p>
                      <p><%= trip[:details][:return_trip_duration]%></p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      <div class="flight_details_container col s6">
        <div id="results_details_container" >
         <%= render 'result_details', result_details: @trips_results[0] %>
        </div>
      </div>
    </div>
  </div>
</div>

<% content_for(:after_js) do %>
  <script>
    $(document).ready(function(){
      // Slider initialization
      $('.date_representation_sliders').each(function(){
        var slider = noUiSlider.create(this, {
          start: [$(this).data('departure_date_day'), $(this).data('arrival_date_day')],
          tooltips: true,
          connect: true,
          step: 1,
          range: {
            'min': 1,
            'max': 31,
          },
          format: {
            to: function ( value ) {
              return value + '';
            },
            from: function ( value ) {
              return value.replace('.00', $(this).data('departure_date_month'));
            }
          },
          disabled: true,
        });
        this.setAttribute('disabled', true);
      });

      // Flight results
      var trips_results_details = [];
      <% @trips_results.each_with_index do |result_details, index| %>
        var result_details = "<%= j render 'result_details', result_details: result_details %>"
        trips_results_details[<%= index %>] = result_details
      <% end %>

      // Register click on card result
      $('.card_result').click(function(){

        $('.card_result').removeClass('selected');
        $(this).toggleClass('selected');

        // Detect the index
        var index = $(this).data('trip_index');
        var result_details_div = trips_results_details[index];
        $('#results_details_container').html(result_details_div);
      })




    })
  </script>
<% end %>
